module semaforo_cruzamento_completo (
    input clk,          // Clock de 1Hz para temporização    // Clock de ~2Hz ou 4Hz para o efeito de piscar
    input reset,
    input botao_A,      // Pedestre quer atravessar a Via A
    input botao_B,      // Pedestre quer atravessar a Via B
    output reg [2:0] light_A, // [R, Y, G]
    output reg [2:0] light_B, // [R, Y, G]
    output reg p_light_A,     // Semáforo Pedestre A
    output reg p_light_B      // Semáforo Pedestre B
);

    // Estados
    parameter A_VERDE   = 3'b000,
              A_AMARELO = 3'b001,
              B_VERDE   = 3'b010,
              B_AMARELO = 3'b011;

    reg [2:0] state_reg, state_next;
    reg [3:0] count;

    // Tempos
    localparam T_VERDE   = 4'd10, 
               T_AMARELO = 4'd5; // 5 segundos conforme solicitado

    // Máquina de Estados e Contador
    always @(posedge clk or posedge reset) begin
        if (reset) begin
            state_reg <= A_VERDE;
            count <= 0;
        end else begin
            if (count < (state_reg[0] ? T_AMARELO : T_VERDE)) begin
                count <= count + 1;
                // Se apertar o botão, acelera o fim do verde
                if (botao_A && state_reg == A_VERDE && count < (T_VERDE-1)) count <= T_VERDE;
                if (botao_B && state_reg == B_VERDE && count < (T_VERDE-1)) count <= T_VERDE;
            end else begin
                state_reg <= state_next;
                count <= 0;
            end
        end
    end

    // Lógica de Transição
    always @(*) begin
        case (state_reg)
            A_VERDE:   state_next = A_AMARELO;
            A_AMARELO: state_next = B_VERDE;
            B_VERDE:   state_next = B_AMARELO;
            B_AMARELO: state_next = A_VERDE;
            default:   state_next = A_VERDE;
        endcase
    end

    // Lógica de Saída das Luzes e Pisca
    always @(*) begin
        // Padrão: Carros Vermelho, Pedestres desligados
        light_A = 3'b100; light_B = 3'b100;
        p_light_A = 1'b0; p_light_B = 1'b0;

        case (state_reg)
            A_VERDE: begin
                light_A = 3'b001; // Verde Carro A
                p_light_B = 1'b1; // Pedestre B pode passar fixo
            end
            
            A_AMARELO: begin
                light_A = 3'b010; // Amarelo Carro A
                // Pedestre B começa a piscar (Via B ainda está no vermelho para carros)
                p_light_B = clk; 
            end

            B_VERDE: begin
                light_B = 3'b001; // Verde Carro B
                p_light_A = 1'b1; // Pedestre A pode passar fixo
            end

            B_AMARELO: begin
                light_B = 3'b010; // Amarelo Carro B
                // Pedestre A começa a piscar (Via A ainda está no vermelho para carros)
                p_light_A = clk;
            end
        endcase
    end

endmodule